# Copyright (C) 2019 Intel Corporation
# SPDX-License-Identifier: BSD-3-Clause

# This file is automatically generated.

# Listen on this specific port instead of the standard DNS port
# (53). Setting this to zero completely disables DNS function,
# leaving only DHCP and/or TFTP.
port=0

# Set this (and domain: see below) if you want to have a domain
# automatically added to simple names in a hosts-file.
expand-hosts

# Set the domain for dnsmasq. this is optional, but if it is set, it
# does the following things.
# 1) Allows DHCP hosts to have fully qualified domain names, as long
#     as the domain part matches this setting.
# 2) Sets the "domain" DHCP option thereby potentially setting the
#    domain of all systems configured by DHCP
# 3) Provides the domain part for "expand-hosts"
domain=builder.local

# Define the network interface which should be used by ESP. This interface
# will then act as the Gateway for the targets. All targets will get an IP
# in the same address range as the chosen interface. If no interface is
# selected, ESP will use the default interface. The interface is selected 
# via the config.yml file
@@INTERFACE_BINDING@@

# Define a list of static mac address to IP Address
@@IP_MAPPING@@

# Enable the integrated DHCP server, you need
# to supply the range of addresses available for lease
#dhcp-range=@@DHCP_MIN@@,@@DHCP_MAX@@,6h
dhcp-range=@@DHCP_RANGE@@

# Override the default route supplied by dnsmasq, which assumes the
# router is the same machine as the one running dnsmasq.
dhcp-option=3,@@NETWORK_GATEWAY_IP@@

# set dns name servers
dhcp-option=6,@@NETWORK_DNS_PRIMARY@@,@@NETWORK_DNS_SECONDARY@@

# network broadcast
dhcp-option=28,@@NETWORK_BROADCAST_IP@@

# NTP server, default to this machine
# dhcp-option=42,0.0.0.0

# Type   Architecture Name
# ----   -----------------
#   0    Intel x86PC
#   1    NEC/PC98
#   2    EFI Itanium
#   3    DEC Alpha
#   4    Arc x86
#   5    Intel Lean Client
#   6    EFI IA32
#   7    EFI BC
#   8    EFI Xscale
#   9    EFI x86-64

# Serve out legacy binaries to legacy PXE clients
dhcp-match=set:x86PC,option:client-arch,0
# dhcp-boot=tag:legacy,pxelinux.0
dhcp-boot=tag:x86PC,ipxe/legacy/undionly.kpxe

# Serve out UEFI-compatible binaries to UEFI32 PXE clients
dhcp-match=set:IA32_EFI,option:client-arch,6
# dhcp-boot=tag:uefi32,efi32/syslinux.efi
dhcp-boot=tag:IA32_EFI,ipxe/efi32/ipxe.efi

# Serve out UEFI-compatible binaries to UEFI64 PXE clients
dhcp-match=set:BC_EFI,option:client-arch,7
dhcp-match=set:X86-64_EFI,option:client-arch,9
dhcp-boot=tag:BC_EFI,ipxe/efi64/ipxe.efi
dhcp-boot=tag:X86-64_EFI,ipxe/efi64/ipxe.efi

# Serve out UEFI HTTPClient Boot
dhcp-match=set:X86-64_EFI_HTTP,option:client-arch,16
dhcp-userclass=set:iPXE,iPXE
dhcp-option=lan,tag:X86-64_EFI_HTTP,tag:!iPXE,option:bootfile-name,http://@@HOST_IP@@/tftp/ipxe/efi64/ipxe.efi
dhcp-option=lan,tag:X86-64_EFI_HTTP,tag:!iPXE,option:vendor-class,HTTPClient
dhcp-boot=tag:X86-64_EFI_HTTP,http://@@HOST_IP@@/tftp/ipxe/efi64/ipxe.efi

# Fallback to telling all other clients to boot
dhcp-boot=tag:!X86-64_EFI,tag:!BC_EFI,tag:!IA32_EFI,ipxe/legacy/undionly.kpxe

# Enable ipxe menu
dhcp-match=set:ipxe,175
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:ipxe,http://@@HOST_IP@@/menu.ipxe

# PXE Service
# @@PXE_COMMENT@@pxe-prompt="Select PXE Boot Type:", 5
# x86PC gets rom from above matches
# @@PXE_COMMENT@@pxe-service=x86PC, "PXELINUX (0000-Intel x86PC)", "ipxe/legacy/undionly.kpxe"
@@PXE_COMMENT@@pxe-service=PC98, "PXELINUX (0001-NEC/PC98)", "ipxe/legacy/undionly.kpxe"
@@PXE_COMMENT@@pxe-service=IA64_EFI, "PXELINUX (0002-EFI Itanium)", "ipxe/pcbios/ipxe.efi"
@@PXE_COMMENT@@pxe-service=Alpha, "PXELINUX (0003-DEC Alpha)", "ipxe/legacy/undionly.kpxe"
@@PXE_COMMENT@@pxe-service=Arc_x86, "PXELINUX (0004-Arc x86)", "ipxe/legacy/undionly.kpxe"
@@PXE_COMMENT@@pxe-service=Intel_Lean_Client, "PXELINUX (0005-Intel Lean Client)", "ipxe/legacy/undionly.kpxe"
@@PXE_COMMENT@@pxe-service=IA32_EFI, "PXELINUX (0006-EFI IA32)", "ipxe/efi32/ipxe.efi"
@@PXE_COMMENT@@pxe-service=BC_EFI, "PXELINUX (0007-EFI BC)", "ipxe/efi64/ipxe.efi"
@@PXE_COMMENT@@pxe-service=Xscale_EFI, "PXELINUX (0008-EFI Xscale)", "ipxe/efi64/ipxe.efi"
@@PXE_COMMENT@@pxe-service=X86-64_EFI, "PXELINUX (0009-EFI x86-64)", "ipxe/efi64/ipxe.efi"
@@PXE_COMMENT@@pxe-service=ARM64_EFI, "PXELINUX (00011-EFI ARM-64)", "ipxe/arm64/ipxe.efi"

@@PXE_COMMENT@@pxe-service=tag:ipxe, BC_EFI, "iPXE Menu", "http://@@HOST_IP@@/menu.ipxe"
@@PXE_COMMENT@@pxe-service=tag:ipxe, X86-64_EFI, "iPXE Menu", "http://@@HOST_IP@@/menu.ipxe"
@@PXE_COMMENT@@pxe-service=tag:ipxe, x86PC, "iPXE Menu", "http://@@HOST_IP@@/menu.ipxe"

# PXELINUX: Previous method
# @@PXE_COMMENT@@pxe-service=x86PC, "PXELINUX (BIOS HTTP)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=x86PC, "PXELINUX (BIOS TFTP)", "legacy/pxelinux.0"
# @@PXE_COMMENT@@pxe-service=IA32_EFI, "PXELINUX (EFI IA32)", "efi32/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=X86-64_EFI, "PXELINUX (EFI x86-64)", "efi64/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=BC_EFI, "PXELINUX (EFI BC)", "efi64/syslinux.efi"

# @@PXE_COMMENT@@pxe-service=0, "PXELINUX (0000-Intel x86PC)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=0, "PXELINUX (0000-Intel x86PC TFTP)", "legacy/pxelinux.0"
# @@PXE_COMMENT@@pxe-service=1, "PXELINUX (0001-NEC/PC98)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=2, "PXELINUX (0002-EFI Itanium)", "efi32/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=3, "PXELINUX (0003-DEC Alpha)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=4, "PXELINUX (0004-Arc x86)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=5, "PXELINUX (0005-Intel Lean Client)", "lpxelinux.0"
# @@PXE_COMMENT@@pxe-service=6, "PXELINUX (0006-EFI IA32)", "efi32/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=7, "PXELINUX (0007-EFI BC)", "efi64/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=8, "PXELINUX (0008-EFI Xscale)", "efi64/syslinux.efi"
# @@PXE_COMMENT@@pxe-service=9, "PXELINUX (0009-EFI x86-64)", "efi64/syslinux.efi"

# Enable dnsmasq's built-in TFTP server
enable-tftp

# Set the root directory for files available via FTP.
tftp-root=/srv/tftp

# Execute the following command when ever a system requests an IP address
# Example execution: /path/to/command add 3c:a4:44:68:f6:AB 10.1.1.198
# dhcp-script /path/to/command